<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Host Dashboard</title>
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <div class="host-dashboard">
        <div class="header">
          <h1>Host Dashboard</h1>
          <div class="session-info">
            <div class="session-id-box">
              <label>Session ID:</label>
              <div class="id-display">
                <strong id="sessionId"></strong>
                <button onclick="copySessionId()" class="btn btn-small">Copy ID</button>
              </div>
            </div>
          </div>
        </div>

        <div class="setup-section" id="setupSection">
          <h2>Setup Your Polls</h2>
          <form id="pollForm" class="poll-form">
            <input type="hidden" id="editingPollIndex" value="" />
            <div class="form-group">
              <label for="pollCreator">Creator:</label>
              <div style="display: flex; gap: 8px; align-items: flex-start;">
                <div style="flex: 1;">
                  <select id="pollCreator" required style="width: 100%;">
                    <option value="">Select a creator...</option>
                  </select>
                  <div id="creatorsList" style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 6px;"></div>
                </div>
                <button type="button" onclick="showAddCreatorDialog()" class="btn btn-small btn-secondary" style="margin-top: 0;">
                  + Add
                </button>
              </div>
            </div>

            <div class="form-group">
              <label for="pollCompany">Company:</label>
              <div style="display: flex; gap: 8px; align-items: flex-start;">
                <div style="flex: 1;">
                  <select id="pollCompany" required style="width: 100%;">
                    <option value="">Select a company...</option>
                    <option value="__custom__">Type custom company...</option>
                  </select>
                  <input
                    type="text"
                    id="pollCompanyCustom"
                    placeholder="e.g., Acme Corporation"
                    style="width: 100%; margin-top: 8px; display: none;"
                  />
                  <div id="companiesList" style="margin-top: 8px; display: flex; flex-wrap: wrap; gap: 6px;"></div>
                </div>
                <button type="button" onclick="showAddCompanyDialog()" class="btn btn-small btn-secondary" style="margin-top: 0;">
                  + Add
                </button>
              </div>
            </div>

            <div class="form-group">
              <label for="pollTimer">Timer (seconds):</label>
              <input type="number" id="pollTimer" min="10" max="600" value="60" placeholder="60" />
              <small style="color: #666; display: block; margin-top: 5px">
                How long voters have to rate this poll (10-600 seconds, default: 60)
              </small>
            </div>

            <div class="form-group">
              <label>Media URLs (comma or line separated):</label>
              <textarea
                id="mediaUrls"
                rows="5"
                placeholder="https://i.imgur.com/example1.jpg, https://youtube.com/watch?v=xxxxx, https://i.imgur.com/example2.png"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ddd;
                  border-radius: 6px;
                  font-size: 14px;
                  font-family: monospace;
                "
              ></textarea>
              <small style="color: #666; display: block; margin-top: 5px">
                <strong>üìπ For Videos:</strong> Use YouTube URLs (e.g.,
                https://youtube.com/watch?v=xxxxx) or Google Drive URLs (e.g.,
                https://drive.google.com/file/d/xxxxx/view)<br />
                <strong>üñºÔ∏è For Images:</strong> Use Imgur direct image URLs (e.g.,
                https://i.imgur.com/xxxxx.jpg)<br />
                <br />
                <strong style="color: #48bb78">‚úì Multiple items:</strong> Enter URLs separated by commas (URL1, URL2, URL3) or one per line<br />
                <strong style="color: #667eea">‚ÑπÔ∏è With quotes:</strong> "URL1", "URL2", "URL3" also works<br />
                <strong style="color: #667eea">‚ÑπÔ∏è Navigation:</strong> Voters will see arrows to
                browse through items
              </small>
            </div>

            <div style="display: flex; gap: 10px; align-items: center">
              <button type="submit" class="btn btn-primary" id="submitPollBtn">Add Poll</button>
              <button
                type="button"
                class="btn btn-secondary hidden"
                id="cancelEditBtn"
                onclick="cancelEdit()"
              >
                Cancel
              </button>
            </div>
          </form>

          <div class="polls-list" id="pollsList">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h3 style="margin: 0;">Created Polls:</h3>
              <div style="display: flex; gap: 10px; align-items: center;">
                <label style="display: flex; align-items: center; gap: 6px; cursor: pointer; font-size: 14px; color: #e53e3e;">
                  <input type="checkbox" id="deleteModeToggle" style="width: auto; cursor: pointer;" />
                  <span><strong>Delete Mode</strong> üóëÔ∏è</span>
                </label>
                <button class="btn btn-secondary" onclick="clearAllPolls()" style="font-size: 14px; padding: 8px 15px;">Clear All Polls</button>
              </div>
            </div>
            <div id="pollsContainer"></div>
          </div>

          <div style="display: flex; gap: 10px; align-items: center; margin-top: 20px;">
            <button id="startVotingBtn" class="btn btn-success" disabled>Start Voting Session</button>
            <button id="clearVotesBtn" class="btn btn-secondary" onclick="clearAllVotes()" style="display: none;">Clear All Votes</button>
          </div>
        </div>

        <div class="voting-section hidden" id="votingSection">
          <div class="current-poll">
            <div class="timer-display" id="timerDisplay">
              <span id="timerText">Time remaining: <strong id="timerValue">60</strong>s</span>
            </div>
            <h2 id="currentPollTitle"></h2>
            <div id="currentPollMedia" class="media-container"></div>

            <div class="results-panel">
              <h3>Live Results</h3>
              <div class="stats">
                <div class="stat-box">
                  <span class="stat-label">Total Votes:</span>
                  <span class="stat-value" id="totalVotes">0</span>
                </div>
                <div class="stat-box">
                  <span class="stat-label">Average Rating:</span>
                  <span class="stat-value" id="averageRating">-</span>
                </div>
              </div>
              <div id="ratingsList" class="ratings-list"></div>
            </div>

            <div style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer; margin-bottom: 10px;">
                <input type="checkbox" id="exposeThem" style="width: auto; cursor: pointer;" />
                <span>Expose them üòé</span>
              </label>
              <small style="color: #666; display: block; margin-bottom: 15px">
                Check this to reveal who was the last person to vote on this poll in the final results
              </small>

              <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="exposeThemV2" style="width: auto; cursor: pointer;" />
                <span>Expose them v2 üòé</span>
              </label>
              <small style="color: #666; display: block; margin-top: 5px">
                Check this to reveal who did NOT vote on this poll in the final results
              </small>
            </div>

            <div style="margin: 15px 0; padding: 12px; background: #f0f8ff; border-radius: 8px; border-left: 4px solid #4a90e2;">
              <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; margin-bottom: 8px;">
                <input type="checkbox" id="autoAdvanceToggle" style="width: auto; cursor: pointer; transform: scale(1.2);" />
                <span><strong>Auto-Advance Mode</strong> üöÄ</span>
              </label>
              <small style="color: #555; display: block; line-height: 1.4;">
                ‚Ä¢ Poll auto-advances after 70% vote + 10s countdown<br/>
                ‚Ä¢ Carousel rotates every 5s ‚Ä¢ Videos autoplay + advance after 60s
              </small>
            </div>

            <div class="poll-controls">
              <button id="nextPollBtn" class="btn btn-primary">Next Poll</button>
              <span id="pollProgress"></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Resume/Restart Dialog Modal -->
    <div id="resumeModal" class="modal hidden">
      <div class="modal-content">
        <h2>Resume Session</h2>
        <p>This session was previously paused. How would you like to continue?</p>
        <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center;">
          <button id="resumeFromPauseBtn" class="btn btn-primary">Resume from Poll <span id="pausedPollNumber"></span></button>
          <button id="restartSessionBtn" class="btn btn-secondary">Restart from Beginning</button>
        </div>
      </div>
    </div>

    <style>
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .modal.hidden {
        display: none;
      }

      .modal-content {
        background: white;
        padding: 30px;
        border-radius: 12px;
        max-width: 600px;
        width: 90%;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-content h2 {
        margin-bottom: 15px;
        color: #333;
      }

      .modal-content p {
        color: #555;
        margin-bottom: 10px;
      }
    </style>

    <script src="/js/host.js"></script>
  </body>
</html>
